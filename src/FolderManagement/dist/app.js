define(["TFS/VersionControl/Contracts","q","VSS/Context","TFS/VersionControl/GitRestClient","TFS/VersionControl/TfvcRestClient"],function(e,t,n,o,r){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){var o,r;o=[n,t,n(9)],void 0!==(r=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.disableTelemetry="false",this.disableAjaxTracking="false",this.enableDebug="false"}return e}();t.TelemetryClientSettings=o;var r=function(){function e(){this.IsAvailable=!0}return e.getClient=function(t){return this._instance||(console.log("Creating new TelemetryClient!"),this._instance=new e,this._instance.Init(t)),this._instance},e.prototype.Init=function(e){console.log("TelemetryClient settings key: "+e.key.substring(0,8)+"************"),console.log("TelemetryClient settings extension context: "+e.extensioncontext),console.log("TelemetryClient settings disableTelemetry: "+("true"===e.disableTelemetry)),console.log("TelemetryClient settings disableAjaxTracking: "+("true"===e.disableAjaxTracking)),console.log("TelemetryClient settings enableDebug: "+("true"===e.enableDebug));var t={instrumentationKey:e.key,disableTelemetry:"true"===e.disableTelemetry,disableAjaxTracking:"true"===e.disableAjaxTracking,enableDebug:"true"===e.enableDebug};this.ExtensionContext=e.extensioncontext;try{var o=VSS.getWebContext();n.AppInsights.downloadAndSetup(t),n.AppInsights.setAuthenticatedUserContext(o.user.id,o.collection.id)}catch(e){console.log(e)}},e.prototype.trackPageView=function(e,t,o,r,i){try{n.AppInsights.trackPageView(this.ExtensionContext+"."+e,t,o,r,i),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackEvent=function(e,t,o){try{console.log("Tracking event: "+this.ExtensionContext+"."+e),n.AppInsights.trackEvent(this.ExtensionContext+"."+e,t,o),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackException=function(e,t,o,r){try{console.error(e);var i={name:this.ExtensionContext+"."+t,message:e};n.AppInsights.trackException(i,t,o,r),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackMetric=function(e,t,o,r,i,a){try{n.AppInsights.trackMetric(this.ExtensionContext+"."+e,t,o,r,i,a),n.AppInsights.flush()}catch(e){console.log(e)}},e}();t.TelemetryClient=r}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r;o=[n,t],void 0!==(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.settings={disableAjaxTracking:"false",disableTelemetry:"false",enableDebug:"false",extensioncontext:"FolderManagement",key:"__InstrumentationKey__"}}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r;o=[n,t,n(0),n(1)],void 0!==(r=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.actionContext=e}return e.prototype.refreshBrowserWindow=function(){VSS.getService(VSS.ServiceIds.Navigation).then(function(e){e.reload()})},e.prototype.showDuplicateFolderError=function(e){n.TelemetryClient.getClient(o.settings).trackEvent("Duplicate_Folder_Name_Entered"),$(".error-container").text("The folder "+e+" already exists")},e.prototype.hideDuplicateFolderError=function(){n.TelemetryClient.getClient(o.settings).trackEvent("Duplicate_Folder_Name_Resolved"),$(".error-container").text("")},e}();t.FolderManager=r}.apply(t,o))&&(e.exports=r)},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){var o,r,i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(3),n(10),n(2),n(4),n(0),n(1)],void 0!==(r=function(e,t,n,o,r,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var n=e.call(this,t)||this;return n.dialogCallback=function(e){var t=n.actionContext,r=e.folderName,i=e.placeHolderFileName,a=t.gitRepository.id,l=t.version,u=n.actionContext.item?n.actionContext.item.path:"",p=e.comment,d=o.getClient();d.getRefs(a,void 0,"heads/"+l).then(function(e){var t=e[0].objectId,o=n.getCommitData(l,t,u,r,i,p);d.createPush(o,a,void 0).then(function(){s.TelemetryClient.getClient(c.settings).trackEvent("Git_Folder_Added"),n.refreshBrowserWindow()})})},n}return i(t,e),t.prototype.checkDuplicateFolder=function(e){var t=a.defer(),r=this.actionContext,i=r.gitRepository.id,s=r.version,c=this.actionContext.item.path,l=o.getClient(),u={version:s,versionOptions:n.GitVersionOptions.None,versionType:n.GitVersionType.Branch};return l.getItems(i,null,null,n.VersionControlRecursionType.Full,!0,!1,!1,!1,u).then(function(n){"/"===c&&(c="");for(var o=c+"/"+e,r=0,i=n;r<i.length;r++){var a=i[r];if(a.isFolder&&a.path.length<=o.length&&0===a.path.indexOf(o))return void t.resolve(!0)}t.resolve(!1)}),t.promise},t.prototype.getCommitData=function(e,t,n,o,r,i){return{commits:[{changes:[{changeType:"add",item:{path:n+"/"+o+"/"+r},newContent:{content:"Git placeholder file",contentType:"rawtext"}}],comment:i}],refUpdates:[{name:"refs/heads/"+e,oldObjectId:t}]}},t}(r.FolderManager);t.GitFolderManager=l}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r,i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(5),n(2),n(11),n(3),n(4),n(0),n(1)],void 0!==(r=function(e,t,n,o,r,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t){var o=e.call(this,t)||this;return o.dialogCallback=function(e){var t,i=r.getClient(),a=o.actionContext.item.path+"/"+e.folderName;t=n.getPageContext().webAccessConfiguration.isHosted?o.getDataForHostedVSTS(e,a):o.getDataForOnPremesisTFS(e,a),i.createChangeset(t).then(function(){c.TelemetryClient.getClient(l.settings).trackEvent("TFVC_Folder_Added"),o.refreshBrowserWindow()})},o}return i(t,e),t.prototype.checkDuplicateFolder=function(e){var t=this,n=s.defer(),o=r.getClient(),i=this.actionContext.item.path+"/"+e;return o.getItems(void 0,i,a.VersionControlRecursionType.OneLevel,!1,void 0).then(function(e){t.checkFolderExists(o,i,e)?n.resolve(!0):n.resolve(!1)}),n.promise},t.prototype.getDataForOnPremesisTFS=function(e,t){return{changes:[{changeType:a.VersionControlChangeType.Add,item:{contentMetadata:{encoding:65001},path:t+"/"+e.placeHolderFileName},newContent:{content:"Placeholder file for new folder",contentType:a.ItemContentType.RawText}}],comment:e.comment}},t.prototype.getDataForHostedVSTS=function(e,t){return{changes:[{changeType:a.VersionControlChangeType.Add,item:{isFolder:!0,path:t}}],comment:e.comment}},t.prototype.checkFolderExists=function(e,t,n){for(var o=0,r=n;o<r.length;o++){var i=r[o];if(i.isFolder&&0===i.path.indexOf(t))return!0}return!1},t}(o.FolderManager);t.TFVCFolderManager=u}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r;o=[n,t,n(6),n(7),n(0),n(1)],void 0!==(r=function(e,t,n,o,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.Git=0]="Git",e[e.TFVC=1]="TFVC"}(a=t.SourceControl||(t.SourceControl={}));var s=function(){function e(){}return e.prototype.execute=function(e){var t=this;e.getSourceItemContext().then(function(e){t.actionContext=e,t.showDialog()})},e.prototype.getSourceControlType=function(){return this.actionContext.gitRepository?a.Git:a.TFVC},e.prototype.showDialog=function(){var e=this;VSS.getService("ms.vss-web.dialog-service").then(function(t){var s,c,l=e.getSourceControlType(),u=VSS.getExtensionContext(),p=u.publisherId+"."+u.extensionId+".createNewFolderDialog",d=null;l===a.Git?(d=new n.GitFolderManager(e.actionContext),c=d.dialogCallback,r.TelemetryClient.getClient(i.settings).trackEvent("Git_Dialog_Openend")):(d=new o.TFVCFolderManager(e.actionContext),c=d.dialogCallback,r.TelemetryClient.getClient(i.settings).trackEvent("TFVC_Dialog_Openend"));var f={cancelText:"Cancel",defaultButton:"ok",draggable:!0,getDialogResult:function(){return s?s.getFormInputs():null},modal:!0,okCallback:c,okText:"Create",title:"Create new folder"};t.openDialog(p,f).then(function(t){t.getContributionInstance("createNewFolderDialog").then(function(n){s=n,s.setVersionControl(l),s.setFolderManager(d);var o="";o=l===a.Git?e.actionContext.gitRepository.name+e.actionContext.item.path:e.actionContext.item.path,s.setCurrentPath(o),s.onStateChanged(function(e){t.updateOkButton(e)}),s.initialValidate()})})})},e}();t.AddFolderMenu=s,VSS.register("addFolder",function(e){return new s}),VSS.notifyLoadSucceeded()}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r;o=[n,t],void 0!==(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e._createLazyMethod=function(t){var n=window[e.appInsightsName];n[t]=function(){var e=arguments;n.queue?n.queue.push(function(){return n[t].apply(n,e)}):n[t].apply(n,e)}},e._defineLazyMethods=function(){var t=window[e.appInsightsName];try{t.cookie=document.cookie}catch(e){}t.queue=[];for(var n=["clearAuthenticatedUserContext","flush","setAuthenticatedUserContext","startTrackEvent","startTrackPage","stopTrackEvent","stopTrackPage","trackDependency","trackEvent","trackException","trackMetric","trackPageView","trackTrace"];n.length;)e._createLazyMethod(n.pop())},e._download=function(t){e.appInsightsInstance.config=t;var n=window[e.appInsightsName];if(n.queue||(n.queue=[]),setTimeout(function(){var e=document.createElement("script");e.src=t.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",document.head.appendChild(e)}),!t.disableExceptionTracking){e._createLazyMethod("_onerror");var o=window.onerror;window.onerror=function(e,t,r,i,a){var s=o&&o(e,t,r,i,a);return!0!==s&&n._onerror(e,t,r,i,a),s}}},Object.defineProperty(e,"appInsightsInstance",{get:function(){return window[e.appInsightsName]||(window[e.appInsightsName]={downloadAndSetup:e._download,_defineLazyMethods:e._defineLazyMethods},e._defineLazyMethods()),window[e.appInsightsName]},enumerable:!0,configurable:!0}),e}();n.appInsightsInitialized=!1,n.appInsightsName="appInsights",t.AppInsights=n.appInsightsInstance}.apply(t,o))&&(e.exports=r)},function(e,t){e.exports=o},function(e,t){e.exports=r}])});